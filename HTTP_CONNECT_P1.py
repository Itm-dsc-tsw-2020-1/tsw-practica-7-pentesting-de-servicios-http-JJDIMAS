import requests as req
import mysql.connector as mysql


def HttpConexion(host,c):
    try:
        #Se requiere colocar http:// antes de la dirección ip
        resp = req.get('http://'+ str(host))        
        #Checar el código de estado, si es 200, hay una página que podemos extraer
        if str(resp.status_code) == "200":
            print("Conexion exitosa con: "+ host)
        #Guardamos el código en archivos de texto, esto no fue solicitado y se omitirá en los códigos posteriores
        #Funciona a partir de Python 3. Para eliminar el error de charmap.
        with open("webpage"+str(c)+".txt", "w", encoding="utf-8") as f:
            f.write(str(resp.text))
        f.close()
    except:
        print("Fallo la conexion con: "+ host)


#Datos para las operaciones
conexion = mysql.connect( host='localhost', user= 'root', passwd='', db='puertos' )
operacion = conexion.cursor(buffered=True)
operacion.execute( "SELECT distinct ip FROM dato WHERE servicio = 'http' ; " )
c = 1
for ip in operacion.fetchall() :
    HttpConexion(ip[0],c) 
    c+=1
conexion.close()